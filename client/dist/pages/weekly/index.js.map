{"version":3,"sources":["/src/pages/weekly/index.js"],"names":["apiUri","require","storageKey","Page","data","weeklyDatas","onLoad","e","setData","uid","console","log","onShow","getNextList","onPullDownRefresh","wx","stopPullDownRefresh","onReachBottom","getStartId","toDetail","event","currentTarget","dataset","item","setStorage","key","weeklyCurrent","navigateTo","url","id","length","cb","startId","params","that","showNavigationBarLoading","request","getWeeklyList","success","res","list","concat","hideNavigationBarLoading"],"mappings":"AAAA,MAAMA,SAASC,QAAQ,iBAAR,CAAf;AACA,MAAMC,aAAaD,QAAQ,kBAAR,EAA4BC,UAA/C;;AAEAC,KAAK;AACHC,QAAM;AACJC,iBAAa;AADT,GADH;AAIHC,SAAQC,CAAR,EAAW;AACT,SAAKC,OAAL,CAAa;AACXC,WAAKF,EAAEE;AADI,KAAb;AAGAC,YAAQC,GAAR,CAAYJ,CAAZ;AACD,GATE;AAUHK,WAAU;AACR,SAAKC,WAAL;AACD,GAZE;AAaHC,qBAAmB,YAAY;AAC7BJ,YAAQC,GAAR,CAAY,QAAZ;AACA,SAAKE,WAAL,CAAiB,IAAjB,EAAuB,YAAY;AACjCH,cAAQC,GAAR,CAAY,QAAZ;AACAI,SAAGC,mBAAH;AACD,KAHD;AAID,GAnBE;AAoBHC,iBAAe,YAAY;AACzB,SAAKJ,WAAL,CAAiB,KAAKK,UAAL,EAAjB;AACD,GAtBE;AAuBHC,YAAU,UAAUC,KAAV,EAAiB;AACzBV,YAAQC,GAAR,CAAYS,KAAZ,EAAmBA,MAAMC,aAAN,CAAoBC,OAApB,CAA4BC,IAA/C;;AAEA,QAAIA,OAAOH,MAAMC,aAAN,CAAoBC,OAApB,CAA4BC,IAAvC;AACAR,OAAGS,UAAH,CAAc,EAAEC,KAAKvB,WAAWwB,aAAlB,EAAiCtB,MAAMmB,IAAvC,EAAd;AACAR,OAAGY,UAAH,CAAc,EAAEC,KAAK,6BAA6BL,KAAKM,EAAzC,EAAd;AACD,GA7BE;AA8BHX,cAAY,YAAY;AACtB,QAAId,OAAO,KAAKA,IAAL,CAAUC,WAArB;AACA,WAAQD,QAAQA,KAAK0B,MAAL,GAAc,CAAvB,GAA4B1B,KAAKA,KAAK0B,MAAL,GAAc,CAAnB,EAAsBD,EAAlD,GAAuD,CAA9D;AACD,GAjCE;AAkCHhB,eAAa,UAAUgB,EAAV,EAAcE,EAAd,EAAkB;AAC7B,QAAIC,UAAUH,MAAM,CAApB;AACA,QAAII,SAAS,EAAE,WAAWD,OAAb,EAAsB,aAAa,KAAK5B,IAAL,CAAUK,GAA7C,EAAb;AACA,QAAIyB,OAAO,IAAX;AACAnB,OAAGoB,wBAAH;;AAEAzB,YAAQC,GAAR,CAAYX,MAAZ;AACAe,OAAGqB,OAAH,CAAW;AACTR,WAAK5B,OAAOqC,aADH;AAETjC,YAAM6B,MAFG;AAGTK,eAAS,UAAUC,GAAV,EAAe;AACtB,YAAInC,OAAOmC,IAAInC,IAAJ,CAASoC,IAApB;;AAEA,YAAIR,YAAY,CAAhB,EAAmB;AACjBE,eAAK1B,OAAL,CAAa;AACXH,yBAAaD;AADF,WAAb;AAGD,SAJD,MAIO;AACL8B,eAAK1B,OAAL,CAAa;AACXH,yBAAa6B,KAAK9B,IAAL,CAAUC,WAAV,CAAsBoC,MAAtB,CAA6BrC,IAA7B;AADF,WAAb;AAGD;;AAEDW,WAAG2B,wBAAH;AACA,eAAOX,EAAP,KAAc,UAAd,IAA4BA,IAA5B;AACD;AAlBQ,KAAX;AAoBD;AA7DE,CAAL","file":"index.js","sourcesContent":["const apiUri = require('../../utils/api')\nconst storageKey = require('../../utils/util').storageKey\n\nPage({\n  data: {\n    weeklyDatas: []\n  },\n  onLoad (e) {\n    this.setData({\n      uid: e.uid\n    })\n    console.log(e)\n  },\n  onShow () {\n    this.getNextList()\n  },\n  onPullDownRefresh: function () {\n    console.log('开始下拉刷新')\n    this.getNextList(null, function () {\n      console.log('下拉刷新完成')\n      wx.stopPullDownRefresh()\n    })\n  },\n  onReachBottom: function () {\n    this.getNextList(this.getStartId())\n  },\n  toDetail: function (event) {\n    console.log(event, event.currentTarget.dataset.item)\n\n    let item = event.currentTarget.dataset.item\n    wx.setStorage({ key: storageKey.weeklyCurrent, data: item })\n    wx.navigateTo({ url: '/pages/weekly/detail?id=' + item.id })\n  },\n  getStartId: function () {\n    let data = this.data.weeklyDatas\n    return (data && data.length > 0) ? data[data.length - 1].id : 0\n  },\n  getNextList: function (id, cb) {\n    let startId = id || 0\n    let params = { 'startId': startId, 'member_id': this.data.uid }\n    let that = this\n    wx.showNavigationBarLoading()\n\n    console.log(apiUri)\n    wx.request({\n      url: apiUri.getWeeklyList,\n      data: params,\n      success: function (res) {\n        let data = res.data.list\n\n        if (startId === 0) {\n          that.setData({\n            weeklyDatas: data\n          })\n        } else {\n          that.setData({\n            weeklyDatas: that.data.weeklyDatas.concat(data)\n          })\n        }\n\n        wx.hideNavigationBarLoading()\n        typeof cb === 'function' && cb()\n      }\n    })\n  }\n})\n"]}